<p-button *ngIf="unreadCount > 0" type="button" (click)="onSupportClick()" styleClass="layout-support-button">
    <i class="fa fa-headset" pBadge severity="danger" [value]="unreadCount.toString()" style="font-size: 2.5rem"></i>
</p-button>

<p-button *ngIf="unreadCount === 0" type="button" (click)="onSupportClick()" styleClass="layout-support-button">
    <i class="fa fa-headset" style="font-size: 2.5rem"></i>
</p-button>


<p-sidebar [style]="{width: '40%'}" [(visible)]="visible" position=left id="supportTabMenu"
    [transitionOptions]="'.3s cubic-bezier(0, 0, 0.2, 1)'">
    <p-tabView [style]="{ width: '100%'}">
        <p-tabPanel header="{{'layout.support-tabmenu.taps.addTicket' | translate}}" [selected]="isNewTicketSelected">
            <div class="card">
                <form [formGroup]="form" (ngSubmit)="onSubmit()">
                    <div class="col-12">
                        <div class="p-fluid p-formgrid grid">
                            <div class="col-12">
                                <label htmlFor="helpCategoryId">{{'layout.support-tabmenu.fields.supportCategory' |
                                    translate}}</label>
                                <p-dropdown formControlName="helpCategoryId" (onChange)="onCategoriesChanges($event)"
                                    [options]="Categories" optionLabel="title" optionValue="id"
                                    placeholder="{{'layout.support-tabmenu.placeHolders.category' | translate}}">
                                </p-dropdown>
                            </div>
                            <div class="col-12">
                                <label htmlFor="subjectId">{{'layout.support-tabmenu.fields.subject' |
                                    translate}}</label>
                                <p-dropdown formControlName="subjectId" [options]="subjects"
                                    (onChange)="onSubjectDropdownChange($event)" optionLabel="subjectTitle"
                                    optionValue="id"
                                    placeholder="{{'layout.support-tabmenu.placeHolders.subject' | translate }}">
                                </p-dropdown>
                            </div>
                            <div class="col-12" *ngIf="isCustomSubject">
                                <label htmlFor="customSubject">{{'layout.support-tabmenu.fields.customSubject' |
                                    translate}}</label>
                                <input type="text" pInputText formControlName="customSubject" />
                            </div>
                            <div class="col-12">
                                <label>{{'layout.support-tabmenu.fields.requestDetails' | translate}}</label>
                                <textarea id="description" type="text" pInputText name="requestDetails"
                                    formControlName="requestDetails"></textarea>
                            </div>
                            <div class="col-12">
                                <label>{{'layout.support-tabmenu.fields.file' | translate}}</label>
                                <div class="flex align-items-center justify-content-center mt-2" style="display: none;">
                                    <p-button label="{{'layout.support-tabmenu.fields.upload' | translate}}"
                                        icon="pi pi-upload" (click)="onUploadFileClick()"></p-button>
                                    <input type="file" id="ticketFile" style="display: none;"
                                        (change)="onFileSelected($event)">
                                </div>
                                <div class="mt-3 text-center" *ngIf="selectedFile">
                                    <p-message severity="info" [text]="fileUploderText"></p-message>
                                </div>
                            </div>
                            <div class="col-12 text-center">
                                <button pButton pRipple label="Send" icon="pi pi-send" iconPos="right"
                                    class="w-auto mt-3" type="submit" [disabled]="!form.valid"></button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </p-tabPanel>
        <!-- Replace the existing My Tickets tab panel content -->
        <p-tabPanel header="{{'layout.support-tabmenu.taps.myTicket' | translate}}" [selected]="isMyTicketsSelected">
            @if (isMyTicketsLoading) {
            <div class="card flex flex-row gap-4 md:flex-column overflow-auto">
                <div class="w-full">
                    <div class="mb-4">
                        <p-skeleton width="100%" height="40px"></p-skeleton>
                    </div>
                    <div class="grid">
                        @for (item of [1,2,3,4,5]; track item) {
                        <div class="col-12  ">
                            <p-skeleton width="100%" height="100px"></p-skeleton>
                        </div>
                        }
                    </div>
                </div>
            </div>
            } @else if (myTickets.length > 0) {
            <div class="card flex flex-row gap-4 md:flex-column overflow-auto">
                <p-dataView #df filterBy="helpCategoryName,requestDetail,userName" [value]="myTickets"
                    [paginator]="true" [rows]="5" layout="grid">
                    <ng-template pTemplate="header">
                        <div class="col-12">
                            <span class="p-input-icon-left p-mb-2 p-mb-md-0" style="width: 100%;">
                                <i class="pi pi-search"></i>
                                <input type="search" style="width: 100%;" pInputText
                                    placeholder="{{'layout.support-tabmenu.placeHolders.search' | translate}}"
                                    (input)="onGlobalFilterII(df, $event)" />
                            </span>
                        </div>
                    </ng-template>
                    <ng-template let-myTickets pTemplate="gridItem">
                        <app-myTicket-card (CardClicked)="currentMyTicketClicked($event)"
                            pTooltip="{{'layout.support-tabmenu.placeHolders.openthisticket' | translate}}"
                            tooltipPosition="bottom" (ForwardCardClicked)="currentMyTicketClickedToForward($event)"
                            *ngFor="let ticket of myTickets" [ticket]="ticket"></app-myTicket-card>
                    </ng-template>
                </p-dataView>
            </div>
            } @else {
            <div class="card">
                <div class="col-12">
                    <div class="card">
                        <h4>{{'layout.support-tabmenu.emptyMessage.title' | translate }}</h4>
                        <p>{{'layout.support-tabmenu.emptyMessage.details'| translate}}</p>
                    </div>
                </div>
            </div>
            }
        </p-tabPanel>

        <!-- Replace the existing All Tickets tab panel content -->
        <p-tabPanel *ngIf="hasPermission(actions.allTicketsTab)"
            header="{{'layout.support-tabmenu.taps.allTicket' | translate}}" [selected]="isAllTicketsSelected">
            @if (isAllTicketsLoading) {
            <div class="card flex flex-row gap-4 md:flex-column overflow-auto">
                <div class="w-full">
                    <div class="mb-4">
                        <p-skeleton width="100%" height="40px"></p-skeleton>
                    </div>
                    <div class="grid">
                        @for (item of [1,2,3,4,5]; track item) {
                        <div class="col-12  ">
                            <p-skeleton width="100%" height="100px"></p-skeleton>
                        </div>
                        }
                    </div>
                </div>
            </div>
            } @else if (allTickets.length > 0) {
            <div class="card flex flex-row gap-4 md:flex-column overflow-auto">
                <p-dataView #dv filterBy="helpCategoryName,requestDetail,userName" [value]="allTickets"
                    [paginator]="true" [rows]="5" layout="grid">
                    <ng-template pTemplate="header">
                        <div class="col-12">
                            <span class="p-input-icon-left p-mb-2 p-mb-md-0" style="width: 100%;">
                                <i class="pi pi-search"></i>
                                <input type="search" style="width: 100%;" pInputText
                                    placeholder="{{'layout.support-tabmenu.placeHolders.search' | translate}}"
                                    (input)="onGlobalFilter(dv, $event)" />
                            </span>
                        </div>
                    </ng-template>
                    <ng-template let-allTickets pTemplate="gridItem">
                        <app-all-ticket-card (CardClicked)="currentAllTicketClicked($event)"
                            pTooltip="{{'layout.support-tabmenu.placeHolders.openthisticket' | translate}}"
                            tooltipPosition="bottom" (ForwardCardClicked)="currentAllTicketClickedToForward($event)"
                            *ngFor="let ticket of allTickets" [ticket]="ticket"></app-all-ticket-card>
                    </ng-template>
                </p-dataView>
            </div>
            } @else {
            <div class="card">
                <div class="col-12">
                    <div class="card">
                        <h4>{{'layout.support-tabmenu.emptyMessage.title' | translate }}</h4>
                        <p>{{'layout.support-tabmenu.emptyMessage.details'| translate}}</p>
                    </div>
                </div>
            </div>
            }
        </p-tabPanel>
    </p-tabView>
</p-sidebar>


<p-sidebar [style]="{width: '40%'}" [modal]="true" [(visible)]="visibleMyTicketChatt" position="left"
    [transitionOptions]="'.3s cubic-bezier(0, 0, 0.2, 1)'">
    <app-my-ticket-chat-box [ticket]="currentMyTicketSelected"></app-my-ticket-chat-box>
</p-sidebar>

<p-sidebar [style]="{width: '40%'}" [modal]="true" [(visible)]="visibleAllTicketChatt" position="left"
    [transitionOptions]="'.3s cubic-bezier(0, 0, 0.2, 1)'">
    <app-all-ticket-chat-box [ticket]="currentAllTicketSelected"></app-all-ticket-chat-box>
</p-sidebar>

<p-dialog [(visible)]="forwardMyDialog" [header]="forwardTicketHeader" [modal]="true"
    [style]="{width:'50%', height:'50%'}">
    <form [formGroup]="formForwardMyTicket" (ngSubmit)="onSubmitMyForward()">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12">
                <label htmlFor="helpCategoryId">{{'layout.support-tabmenu.fields.supportCategory'| translate}}</label>
                <p-dropdown formControlName="helpCategoryId" [options]="Categories" optionLabel="title" optionValue="id"
                    placeholder="Select a Category To Forward">
                </p-dropdown>
            </div>
        </div>
    </form>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text"
            label="{{ 'shared.actions.cancel' | translate}}" (click)="forwardMyDialog = false"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="{{ 'shared.actions.save' | translate}}"
            [disabled]="!formForwardMyTicket.valid" (click)="onSubmitMyForward()"></button>
    </ng-template>
</p-dialog>

<p-dialog [(visible)]="forwardAllDialog" [header]="forwardTicketHeader" [modal]="true"
    [style]="{width:'50%', height:'50%'}">
    <form [formGroup]="formForwardAllTicket" (ngSubmit)="onSubmitAllForward()">
        <div class="p-fluid p-formgrid grid">
            <div class="field col-12">
                <label htmlFor="helpCategoryId">{{'layout.support-tabmenu.fields.supportCategory'| translate}}</label>
                <p-dropdown formControlName="helpCategoryId" [options]="Categories" optionLabel="title" optionValue="id"
                    placeholder="Select a Category To Forward">
                </p-dropdown>
            </div>
        </div>
    </form>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text"
            label="{{ 'shared.actions.cancel' | translate}}" (click)="forwardAllDialog = false"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="{{ 'shared.actions.save' | translate}}"
            [disabled]="!formForwardAllTicket.valid" (click)="onSubmitAllForward()"></button>
    </ng-template>
</p-dialog>