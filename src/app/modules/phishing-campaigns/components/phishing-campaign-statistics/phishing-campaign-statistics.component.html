<p-toast></p-toast>
<p-card>
    <div class="pb-4">
        <p-button [label]="'shared.actions.back' | translate" icon="pi pi-angle-left" iconPos="left" (onClick)="back()"></p-button>
    </div>
    <p-tabView>
        <p-tabPanel header="{{ 'phishing-campaigns.phishing-campaign-statistics.overview' | translate }}">
            <div class="grid">
                <div class="col-12 md:col-8">
                    <div class="ltr col-12">
                        <p-chart type="line" [data]="phishLineChartData" [options]="phishLineChartOptions"></p-chart>
                    </div>
                    <div class="col-12">
                        <div class="col-12">
                            <h3 class="text-center">
                                {{ 'phishing-campaigns.phishing-campaign-statistics.top100Clickers' | translate }}
                            </h3>
                            <div class="col-12 col-12 flex justify-content-end">
                                <div class="mx-3">
                                    <p-button
                                        label="{{ 'shared.actions.csv' | translate }}"
                                        icon="pi pi-file-excel"
                                        [disabled]="
                                            campaignStatisticsData.awarenessCampaignSimulationPhishingTopClickers
                                                .length == 0
                                        "
                                        (onClick)="downloadPhishingClickersReportAsCSV()"></p-button>
                                </div>
                                <div>
                                    <p-button
                                        label="{{ 'shared.actions.pdf' | translate }}"
                                        icon="pi pi-file-pdf"
                                        [disabled]="
                                            campaignStatisticsData.awarenessCampaignSimulationPhishingTopClickers
                                                .length == 0
                                        "
                                        (onClick)="downloadPhishingClickersReportAsPDF()"></p-button>
                                </div>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="iAware-loading-table-container" style="position: relative">
                                <app-table-loading-spinner *ngIf="tableLoadingSpinner"></app-table-loading-spinner>
                                <p-table
                                    [value]="campaignStatisticsData.awarenessCampaignSimulationPhishingTopClickers"
                                    styleClass="p-datatable-striped"
                                    [paginator]="true"
                                    [rows]="10"
                                    responsiveLayout="scroll"
                                    [rowsPerPageOptions]="[10, 25, 50]">
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>
                                                {{
                                                    'phishing-campaigns.phishing-campaign-statistics.userName'
                                                        | translate
                                                }}
                                            </th>
                                            <th>
                                                {{
                                                    'phishing-campaigns.phishing-campaign-statistics.userEmail'
                                                        | translate
                                                }}
                                            </th>
                                            <th class="text-center">
                                                {{
                                                    'phishing-campaigns.phishing-campaign-statistics.clicksCount'
                                                        | translate
                                                }}
                                            </th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-user>
                                        <tr>
                                            <td>{{ user.userName }}</td>
                                            <td>{{ user.userEmail }}</td>
                                            <td class="text-center">{{ user.numberOfClicks }}</td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-12 md:col-4">
                    <p-card [header]="'phishing-campaigns.phishing-campaign-statistics.campaignSummary' | translate" styleClass="campaign-summary-card">
                        <div class="campaign-summary-content">
                            <div class="detail-row mb-2 mt-2">
                                <strong class="mt-3">{{
                                    'phishing-campaigns.phishing-campaign-statistics.status' | translate
                                }}</strong>
                                <span
                                    [ngClass]="{
                                        'status-completed': campaignStatisticsData.campaignStatus === 'Completed',
                                        'status-in-progress': campaignStatisticsData.campaignStatus === 'InProgress',
                                        'status-not-started': campaignStatisticsData.campaignStatus === 'NotStarted'
                                    }"
                                    >{{ campaignStatisticsData.campaignStatus }}</span
                                >
                            </div>
                            <hr />
                            <div class="detail-row mb-2 mt-2">
                                <strong>{{
                                    'phishing-campaigns.phishing-campaign-statistics.name' | translate
                                }}</strong>
                                <span>{{ campaignStatisticsData.campaignName }}</span>
                            </div>
                            <hr />
                            <div class="detail-row mb-2 mt-2">
                                <strong>{{
                                    'phishing-campaigns.phishing-campaign-statistics.startDate' | translate
                                }}</strong>
                                <span>{{ campaignStatisticsData.startDate | date : 'MM/dd/yyyy' }}</span>
                            </div>
                            <hr />
                            <div class="detail-row mb-2 mt-2">
                                <strong>{{
                                    'phishing-campaigns.phishing-campaign-statistics.endDate' | translate
                                }}</strong>
                                <span>{{ campaignStatisticsData.endDate | date : 'MM/dd/yyyy' }}</span>
                            </div>
                            <hr />
                            <div class="detail-row mb-2 mt-2">
                                <strong>{{
                                    'phishing-campaigns.phishing-campaign-statistics.templatesII' | translate
                                }}</strong>
                                <span>{{
                                    campaignStatisticsData.awarenessCampaignSimulationPhishingTemplates.length
                                }}</span>
                            </div>
                            <hr />
                            <div class="detail-row">
                                <strong>{{
                                    'phishing-campaigns.phishing-campaign-statistics.users' | translate
                                }}</strong>
                                <span>{{ campaignStatisticsData.usersCount }}</span>
                            </div>
                        </div>
                    </p-card>
                </div>
                <div class="col-12">
                    <p-card
                        header="{{
                            'phishing-campaigns.phishing-campaign-statistics.campaignLeaderboard' | translate
                        }}">
                        <div class="grid">
                            <div class="col-12 pb-0">
                                <app-iAware-info severity="info" [description]="'phishing-campaigns.phishing-campaign-statistics.campaignLeaderboardMessage' | translate "></app-iAware-info>
                            </div>

                            <div
                                class="col-12 pb-0"
                                *ngIf="leaderboardDataForUsers.rankedUsers.length > 0">
                                <div class="col-12 ranking-container">
                                    <div class="ranking-header">
                                        <span>{{
                                            'phishing-campaigns.phishing-campaign-statistics.ranking' | translate
                                        }}</span>
                                        <span>{{
                                            'phishing-campaigns.phishing-campaign-statistics.name' | translate
                                        }}</span>
                                        <span>{{
                                            'phishing-campaigns.phishing-campaign-statistics.points' | translate
                                        }}</span>
                                    </div>
                                    <p-scrollPanel [style]="{ height: '100vh' }">
                                        <ul class="ranking-list">
                                            <li
                                                *ngFor="let user of leaderboardDataForUsers.rankedUsers"
                                                [ngClass]="{ 'unique-row': user.isUnique }"
                                                class="ranking-row mb-1">
                                                <span class="ranking-no">{{ user.rankingNo }}</span>
                                                <span class="user-name">
                                                    {{ user.userName }}
                                                    <span class="you-badge" *ngIf="user.isUnique"></span>
                                                </span>
                                                <span class="user-points">{{
                                                    user.userPoints | number : '1.0-0'
                                                }}</span>
                                            </li>
                                        </ul>
                                    </p-scrollPanel>
                                </div>
                            </div>

                            <div *ngIf="leaderboardDataForUsers.rankedUsers.length == 0" class="col-12 pb-0">
                                <app-iAware-info severity="info" [description]="'phishing-campaigns.phishing-campaign-statistics.noDataMessage' | translate "></app-iAware-info>
                            </div>
                        </div>
                    </p-card>
                </div>
            </div>
        </p-tabPanel>
        <p-tabPanel header="{{ 'phishing-campaigns.phishing-campaign-statistics.templates' | translate }}">
            <div class="iAware-loading-table-container" style="position: relative">
                <app-table-loading-spinner *ngIf="tableLoadingSpinner"></app-table-loading-spinner>
                <p-table
                    [value]="campaignStatisticsData.awarenessCampaignSimulationPhishingTemplates"
                    styleClass="p-datatable-striped"
                    [paginator]="true"
                    [rows]="10"
                    responsiveLayout="scroll"
                    [rowsPerPageOptions]="[10, 25, 50]">
                    <ng-template pTemplate="header">
                        <tr>
                            <th>{{ 'phishing-campaigns.phishing-campaign-statistics.templateName' | translate }}</th>
                            <!-- <th class="text-center">{{'phishing-campaigns.phishing-campaign-statistics.status' | translate}}</th> -->
                            <th>{{ 'phishing-campaigns.phishing-campaign-statistics.startedOn' | translate }}</th>
                            <th>{{ 'phishing-campaigns.phishing-campaign-statistics.endedOn' | translate }}</th>
                            <th class="text-center">
                                {{ 'phishing-campaigns.phishing-campaign-statistics.noOfUsers' | translate }}
                            </th>
                            <th class="text-center">
                                {{ 'phishing-campaigns.phishing-campaign-statistics.percentage' | translate }}
                            </th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-template>
                        <tr style="cursor: pointer" (click)="navigateToTemplateReport(template)">
                            <td style="color: var(--primary-color)">{{ template.phishingEmailTemplateName }}</td>
                            <!-- <td class="text-center">
                                <span [ngClass]="{
                            'status-active': template.phishingEmailTemplateStatus === 'Active',
                            'status-closed': template.phishingEmailTemplateStatus === 'Closed',
                        }">{{ template.phishingEmailTemplateStatus }}</span> 
                            </td> -->
                            <td>{{ template.phishingStartTime | date : 'MM/dd/yyyy' }}</td>
                            <td>{{ template.phishingEndTime | date : 'MM/dd/yyyy' }}</td>
                            <td class="text-center">
                                {{ template.awarenessCampaignSimulationPhishingScheduleDataOverview.recipients }}
                            </td>
                            <td class="text-center phishPronePercentage">{{ template.phishPronePercentage }}%</td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </p-tabPanel>
    </p-tabView>
</p-card>
