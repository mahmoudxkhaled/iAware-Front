<p-card>
    <p-toast></p-toast>
    <div class="p-col-12">
        <form [formGroup]="form" (ngSubmit)="addPhishingEmailTemplate()">
            <div class="flex justify-content-end">
                <p-button label="{{ 'shared.actions.saveChanges' | translate }}" [disabled]="!form.valid" class="w-auto"
                    icon="pi pi-save" class="p-button-text" type="submit"></p-button>
            </div>
            <p-tabView [style]="{ width: '100%' }">

                <p-tabPanel header="{{ 'phishing-email-template.taps.info' | translate}}">
                    <div class="grid formgrid p-fluid">
                        <div class="field mb-4 col-6">
                            <label for="emailName" class="font-medium text-900">{{ 'phishing-email-template.name' |
                                translate}}</label>
                            <input id="emailName" type="text" pInputText name="emailName" formControlName="emailName"
                                required placeholder="{{ 'phishing-email-template.nameField' | translate}}" />
                            <div *ngIf="form.get('emailName')?.invalid && form.get('emailName')?.touched"
                                class="p-error">
                                {{ 'phishing-email-template.nameValidation' | translate}}
                            </div>
                        </div>

                        <div class="field mb-4 col-6">
                            <label class="font-medium text-900">{{ 'phishing-email-template.language' |
                                translate}}</label>
                            <span>
                                <p-dropdown formControlName="languageId" [options]="defaultLanguage" optionLabel="name"
                                    optionValue="id"
                                    placeholder="{{ 'phishing-email-template.languagePlaceholder' | translate}}">
                                </p-dropdown>
                            </span>
                            <div *ngIf="form.get('languageId')?.invalid && form.get('languageId')?.touched"
                                class="p-error">
                                {{ 'phishing-email-template.languageValidation' | translate}}
                            </div>
                        </div>

                        <div class="field mb-4 col-6">
                            <label class="font-medium text-900">{{ 'phishing-email-template.phishingCategory' |
                                translate}}</label>
                            <span>
                                <p-dropdown formControlName="phishingCategoryId" [options]="categories"
                                    optionLabel="name" optionValue="id"
                                    placeholder="{{ 'phishing-email-template.phishingCategoryPlaceholder' | translate}}">
                                </p-dropdown>
                            </span>
                            <div *ngIf="form.get('phishingCategoryId')?.invalid && form.get('phishingCategoryId')?.touched"
                                class="p-error">
                                {{ 'phishing-email-template.phishingCategoryValidation' | translate}}
                            </div>
                        </div>

                        <div class="field mb-4 col-6">
                            <label class="font-medium text-900">{{ 'phishing-email-template.phishingDomain' |
                                translate}}</label>
                            <span>
                                <p-dropdown formControlName="phishingDomainId" [options]="domains"
                                    optionLabel="domainName" optionValue="id"
                                    placeholder="{{ 'phishing-email-template.phishingDomainPlaceholder' | translate}}">
                                </p-dropdown>
                            </span>
                            <div *ngIf="form.get('phishingDomainId')?.invalid && form.get('phishingDomainId')?.touched"
                                class="p-error">
                                {{ 'phishing-email-template.phishingDomainValidation' | translate}}
                            </div>
                        </div>

                        <div class="field mb-4 col-12">
                            <label class="font-medium text-900">{{ 'phishing-email-template.description' |
                                translate}}</label>
                            <textarea id="description" type="text" pInputText name="description"
                                formControlName="description"
                                placeholder="{{ 'phishing-email-template.descriptionField' | translate}}"></textarea>
                            <div *ngIf="form.get('description')?.invalid && form.get('description')?.touched"
                                class="p-error">
                                {{ 'phishing-email-template.descriptionValidation' | translate}}
                            </div>
                        </div>

                        <div class="field mb-4 col-12">
                            <label class="font-medium text-900">{{ 'phishing-email-template.tages' | translate}}</label>
                            <p-multiSelect
                                [placeholder]="'phishing-email-template.tagesPlaceHolder' | translate"
                                [options]="tages" optionLabel="tagName" optionValue="id"
                                formControlName="phishingEmailTemplateTages"></p-multiSelect>
                        </div>

                        <div class="field mb-4 col-12">
                            <label class="font-medium text-900">{{ 'phishing-email-template.emailInstruction' |
                                translate}}</label>
                            <app-iAware-rich-text id="emailInstruction"
                                placeholder="{{ 'phishing-email-template.emailInstructionField' | translate}}"
                                formControlName="emailInstruction"></app-iAware-rich-text>
                        </div>

                        <div class="field mb-4 col-12">
                            <p-panel header="{{'phishing-email-template.phishingTemplateImage' | translate}}"
                                class="mb-3">

                                <div class="flex align-items-center justify-content-center">
                                    <img [src]="emailImageToAdd" alt="Avatar" class="avatar"
                                        style="width: 100%; max-width: 150px; border-radius: 8px; border: 1px solid #ccc"
                                        (click)="onUploadImageClick()">
                                </div>

                                <!-- Recommended Dimensions -->
                                <small class="text-center block m-2">{{ 'shared.messages.recommendedDimensions' |
                                    translate}} <strong>{{ 'shared.messages.800x449' | translate}}</strong> {{
                                    'shared.messages.pixels' | translate}}</small>

                                <div class="flex align-items-center justify-content-center mt-2" style="display: none;">
                                    <p-button label="{{ 'shared.actions.upload' | translate }}" icon="pi pi-upload"
                                        (click)="onUploadImageClick()"></p-button>
                                    <input type="file" id="emailImage" style="display: none;"
                                        (change)="onImageSelected($event)">
                                </div>
                            </p-panel>
                        </div>
                    </div>
                </p-tabPanel>

                <p-tabPanel header="{{ 'phishing-email-template.taps.emailDeatails' | translate}}">
                    <div class="grid formgrid p-fluid">
                        <div class="field mb-4 col-12">
                            <label for="phishingEmailSubject" class="font-medium text-900">{{
                                'phishing-email-template.phishingEmailSubject' | translate}}</label>
                            <input id="phishingEmailSubject" type="text" pInputText name="phishingEmailSubject"
                                formControlName="phishingEmailSubject"
                                placeholder="{{ 'phishing-email-template.phishingEmailSubjectField' | translate}}" />
                        </div>
                        <div class="field mb-4 col-12">
                            <div class="flex flex-wrap  justify-content-between align-items-center ">
                                <div class="field mb-4 col-6">
                                    <p-inputGroup>
                                        <input type="text" readonly pInputText
                                            [value]="getTextCopiedValue('landingPage')" class="p-2" />
                                        <button type="button" pButton icon="pi pi-copy"
                                            class="p-button-primary border-round-right"
                                            (click)="copylandingPageLinkText()"></button>
                                        <i class="pi pi-question-circle mt-3 ml-3"
                                            pTooltip="{{landingPageInstruction}}"></i>
                                    </p-inputGroup>
                                </div>

                                <div class="field mb-4 col-6">
                                    <p-checkbox [binary]="true" class="font-medium text-900"
                                        label="{{ 'phishing-email-template.IsQrCodeChecked' | translate }}"
                                        [value]="false" formControlName="isQrCodeChecked"> </p-checkbox>
                                    <i class="pi pi-question-circle ml-1" style="font-size: 0.9rem;"
                                        pTooltip="this option mean that the email template will have QRCode"></i>

                                    <div class="mt-3" *ngIf="form.value.isQrCodeChecked">
                                        <p-inputGroup>
                                            <input type="text" readonly pInputText
                                                [value]="getTextCopiedValue('qrCode')" class="p-2" />
                                            <button type="button" pButton icon="pi pi-copy"
                                                class="p-button-primary border-round-right"
                                                (click)="copylandingPageQRCodeText()"></button>
                                        </p-inputGroup>
                                    </div>
                                </div>
                            </div>

                            <label class="font-medium text-900">{{ 'phishing-email-template.phishingEmailContent' |
                                translate}}</label>
                            <app-iAware-rich-text id="phishingEmailContent" formControlName="phishingEmailContent"
                                placeholder="{{ 'phishing-email-template.phishingEmailContentField' | translate}}"></app-iAware-rich-text>
                        </div>
                        <!-- <div class="field mb-4 col-12">
                            <label for="phishingEmailSubject" class="font-medium text-900">Phishing Email Keys:</label>
                            <div formArrayName="phishingLandingPageInputs" class="mb-4 mt-4">
                                <div *ngFor="let group of phishingLandingPageInputs.controls; let i = index"
                                    [formGroupName]="i" class="grid">
                                    <div class="field mb-4 col-12 lg:col-6">
                                        <label class="font-medium text-900">Phishing Landing Page Input Key :</label>
                                        <input pInputText name="phishingLandingPageInputKey" readonly
                                            formControlName="phishingLandingPageInputKey">
                                    </div>
                                    <div class="field mb-4 col-12 lg:col-6">
                                        <label for="phishingLandingPageInputType" class="font-medium text-900">Phishing
                                            Landing Page Input Type :</label>
                                        <p-dropdown formControlName="phishingLandingPageInputType" [options]="typs"
                                            optionLabel="value" optionValue="code" [filter]="true"
                                            placeholder="Select a Type">
                                        </p-dropdown>
                                    </div>
                                    <div class="field mb-4 col-12 lg:col-6">
                                        <label for="phishingLandingPageInputTitle" class="font-medium text-900">Phishing
                                            Landing Page Input Title :</label>
                                        <input pInputText id="phishingLandingPageInputTitle"
                                            name="phishingLandingPageInputTitle"
                                            formControlName="phishingLandingPageInputTitle">
                                    </div>
                                    <div class="field mb-4 col-12 lg:col-6">
                                        <label for="phishingLandingPageInputEvent" class="font-medium text-900">Phishing
                                            Landing Page Input Event :</label>
                                        <p-dropdown formControlName="phishingLandingPageInputEvent" [options]="events"
                                            optionLabel="value" optionValue="code" [filter]="true"
                                            placeholder="Select a Event">
                                        </p-dropdown>
                                    </div>
                                    <div class="field mb-4 col-6 flex justify-content-between">
                                        <p-button icon="pi pi-trash"
                                            [style]="{ 'width.px': 50, 'color':'white', 'background-color':'red', 'border':'none' }"
                                            class="w-auto mt-3" type="button"
                                            (click)="removePhishingLandingPageInput(i)"></p-button>
                                        <p-button icon="pi pi-plus" [style]="{ 'width.px': 50, 'margin-right.px': 5 }"
                                            class="w-auto mt-3" type="button"
                                            (click)="addPhishingLandingPageInput()"></p-button>
                                        <hr>
                                    </div>
                                </div>
                            </div>
                        </div> -->
                    </div>
                </p-tabPanel>

                <p-tabPanel header="{{ 'phishing-email-template.taps.landingPage' | translate}}">
                    <div class="grid formgrid p-fluid">
                        <div class="field mb-4 col-12">
                            <label for="landingPageTitle" class="font-medium text-900">{{
                                'phishing-email-template.landingPageTitle' | translate}}</label>
                            <input id="landingPageTitle" type="text" pInputText name="landingPageTitle"
                                formControlName="landingPageTitle"
                                placeholder="{{ 'phishing-email-template.landingPageTitleField' | translate}}" />
                        </div>
                        <div class="field mb-4 col-12">
                            <label for="landingPageDescription" class="font-medium text-900">{{
                                'phishing-email-template.landingPageDescription' | translate}}</label>
                            <textarea id="landingPageDescription" type="text" pInputText name="landingPageDescription"
                                formControlName="landingPageDescription"
                                placeholder="{{ 'phishing-email-template.landingPageDescriptionField' | translate}}"></textarea>
                        </div>
                        <!-- <div class="field mb-4 col-12 flex">
                            <div *ngFor="let group of phishingLandingPageInpuValues" class="col-6">
                                <label [for]="group.phishingLandingPageInputTitle"
                                    class="font-medium text-900">{{group.phishingLandingPageInputTitle}}({{group.phishingLandingPageInputType}})</label>
                                <p-inputGroup>
                                    <input type="text" readonly pInputText placeholder="Vote"
                                        [value]="getCopyText(group)" [id]="group.phishingLandingPageInputTitle" />
                                    <button type="button" pButton icon="pi pi-copy" class="p-button-primary"
                                        (click)="copyText(group)"></button>
                                </p-inputGroup>
                            </div>
                        </div> -->
                        <div class="field mb-4 col-12">
                            <div class="flex justify-content-between">
                                <div class="flex flex-column justify-content-center">
                                    <label class="font-medium text-900">{{
                                        'phishing-email-template.landingPageContentHtml' | translate}}</label>
                                </div>

                                <div class="advanced-feature-container">
                                    <p-button label="{{ 'phishing-email-template.clone' | translate }}"
                                        icon="pi pi-clone" styleClass="animated-button" (onClick)="cloneDialog = true">
                                    </p-button>
                                </div>
                            </div>
                            <div style="height: 400px" class="mt-3">
                                <ngx-monaco-editor style="height: 100%;" [options]="editorOptions"
                                    formControlName="landingPageContentHtml"></ngx-monaco-editor>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

                <p-tabPanel header="{{ 'phishing-email-template.taps.feedbackPage' | translate}}">
                    <div class="grid formgrid p-fluid">
                        <div class="field mb-4 col-12 ">
                            <div class="field mb-4 col-lg-6">
                                <div class="field mb-4 col-12">
                                    <label for="phishingEmailSuccessMessageTitle" class="font-medium text-900">{{
                                        'phishing-email-template.phishingEmailSuccessMessageTitle' | translate}}</label>
                                    <input id="phishingEmailSuccessMessageTitle" type="text" pInputText
                                        name="phishingEmailSuccessMessageTitle"
                                        placeholder="{{ 'phishing-email-template.phishingEmailSuccessMessageTitleField' | translate}}"
                                        formControlName="phishingEmailSuccessMessageTitle" />
                                </div>
                                <div class="field mb-4 col-12">
                                    <label class="font-medium text-900">{{
                                        'phishing-email-template.phishingEmailSuccessMessagePageHtml' |
                                        translate}}</label>
                                    <app-iAware-rich-text id="phishingEmailSuccessMessagePageHtml"
                                        placeholder="{{ 'phishing-email-template.phishingEmailSuccessMessagePageHtmlField' | translate}}"
                                        formControlName="phishingEmailSuccessMessagePageHtml"></app-iAware-rich-text>
                                </div>
                            </div>
                        </div>
                    </div>
                </p-tabPanel>

            </p-tabView>
        </form>
    </div>
</p-card>

<p-dialog [(visible)]="inputChecklistDialog" [modal]="true" [style]="{width:'450px'}"
    header="{{ 'phishing-email-template.inputChecklistDialogHeader' | translate}}">
    <div class="flex flex-column align-items-start">
        <div *ngFor="let input of inputsToCheck">
            <p-checkbox [binary]="true" (onChange)="addToCheckList($event, input)"
                label="{{input.title}} (Type: {{input.type}})" class="my-1">
            </p-checkbox>
        </div>
    </div>
    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-times" class="p-button-text"
            label="{{ 'shared.actions.cancel' | translate }}" (click)="inputChecklistDialog = false"></button>
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="{{ 'shared.actions.save' | translate }}"
            (click)="confirmChecklist()"></button>
    </ng-template>
</p-dialog>

<p-dialog [(visible)]="cloneDialog" [style]="{ width: '50%', height:'61%' }" [showHeader]="false"
    [dismissableMask]="true" [modal]="true" class="p-fluid">
    <div class="grid">

        <div class="col-12 text-center p-3 mt-3 mb-3">
            <h3>
                {{ 'phishing-email-template.cloneDialogHeader' | translate}}
            </h3>
        </div>

        <div class="col-12">
            <app-iAware-info severity="info"
                [description]="'phishing-email-template.cloningDescription' | translate"></app-iAware-info>
        </div>


        <div class="col-12">
            <div class="grid formgrid p-fluid">
                <div class="field mb-4 col-12">
                    <label for="cloneUrl" class="font-medium text-900">{{ 'phishing-email-template.pageUrl' |
                        translate}}</label>
                    <input id="cloneUrl" type="text" [(ngModel)]="urlToClone" pInputText name="cloneUrl" />
                </div>
            </div>
        </div>

        <div class="col-12 gap-2 flex flex-row-reverse flex-wrap">
            <div class="flex align-items-center justify-content-center">
                <button pButton pRipple label="{{ 'shared.actions.clone' | translate }}" icon="pi pi-check"
                    class="p-button-text" (click)="cloneTemplate()"></button>
            </div>
            <div class="flex align-items-center justify-content-center">
                <button pButton pRipple label="{{ 'shared.actions.cancel' | translate }}" icon="pi pi-times"
                    class="p-button-text" (click)="cloneDialog = false"></button>
            </div>
        </div>

    </div>
</p-dialog>