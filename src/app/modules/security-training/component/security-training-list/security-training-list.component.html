<div class="grid">
    <div class="col-12">
        <div class="card">
            <p-toast></p-toast>
            <div class="iAware-loading-table-container" style="position: relative">
                <app-table-loading-spinner *ngIf="tableLoadingSpinner"></app-table-loading-spinner>

                <p-table #dt [value]="trainingLessons" responsiveLayout="scroll" [rows]="pagination.size"
                    [paginator]="true" [lazy]="true" [totalRecords]="totalRecords" (onLazyLoad)="onLazyLoad($event)"
                    [rowsPerPageOptions]="[10, 20, 30]" styleClass="p-datatable-striped">
                    <ng-template pTemplate="caption">
                        <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                            <h5 class="m-0">Training Lessons Management</h5>
                            <div class="my-1">
                                <button *ngIf="hasPermission(actions.add)" pButton pRipple label="Add Training Lesson"
                                    icon="pi pi-plus" class="p-button-success mr-2"
                                    (click)="navigateToCreateTraining()"></button>
                                <span class="mt-2 md:mt-0 p-input-icon-left">
                                    <i class="pi pi-search"></i>
                                    <input pInputText type="text" (input)="onGlobalFilter(dt, $event)"
                                        placeholder="Search..." class="w-full sm:w-auto" />
                                </span>
                            </div>
                        </div>
                    </ng-template>
                    <ng-template pTemplate="header">
                        <tr>
                            <th style="width: 20%">Name</th>
                            <th style="width: 25%">Description</th>
                            <th style="width: 15%">Category</th>
                            <th style="text-align: center">Number of Lessons</th>
                            <th style="text-align: center">Status</th>
                            <th colspan="2" style="text-align: center">Actions</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-training>
                        <tr>
                            <td>
                                <a [routerLink]="['/Security-Training', training.id]">{{ training.name }}</a>
                            </td>
                            <td>{{ training.description }}</td>
                            <td>{{ training.trainingLessonCategoryName }}</td>
                            <td style="text-align: center">
                                {{ training.lessonsCount }}/{{ this.countOfActiveLanguages }}
                            </td>
                            <td style="text-align: center">
                                <p-inputSwitch *ngIf="hasPermission(actions.active)" [ngModel]="training.isActive"
                                    (onChange)="switchActivation(training)" />
                            </td>
                            <td style="text-align: center">
                                <button *ngIf="hasPermission(actions.edit)" pButton pRipple icon="pi pi-pencil"
                                    class="p-button-rounded p-button-success mr-2"
                                    (click)="editTrainingLesson(training)"></button>
                            </td>
                            <td style="text-align: center">
                                <button *ngIf="hasPermission(actions.delete)" pButton pRipple icon="pi pi-trash"
                                    class="p-button-rounded p-button-danger"
                                    (click)="deleteTrainingLesson(training)"></button>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>

        <p-dialog [(visible)]="editTrainingLessonDialog" [style]="{ width: '50%', height: '100%' }"
            header="Edit Training Lesson" [modal]="true" class="p-fluid">
            <ng-template pTemplate="content">
                <form [formGroup]="editTrainingLessonForm" (ngSubmit)="saveEditTrainingLesson()">
                    <div class="field">
                        <label for="name">Name</label>
                        <input type="text" pInputText id="name" formControlName="name" required autofocus [ngClass]="{
                                'ng-invalid ng-dirty': submitted && !editTrainingLessonForm.controls['name'].valid
                            }" />
                        <small *ngIf="submitted && !editTrainingLessonForm.controls['name'].valid"
                            class="text-red-500">Name is required.</small>
                    </div>
                    <div class="field">
                        <label for="description">Description</label>
                        <textarea id="description" formControlName="description" pInputTextarea required [ngClass]="{
                                'ng-invalid ng-dirty':
                                    submitted && !editTrainingLessonForm.controls['description'].valid
                            }" rows="3" cols="20"></textarea>
                        <small *ngIf="submitted && !editTrainingLessonForm.controls['description'].valid"
                            class="text-red-500">Description is required.</small>
                    </div>
                    <div class="field">
                        <label for="trainingLessonCategoryId">Category</label>
                        <p-dropdown formControlName="trainingLessonCategoryId" [options]="categories" optionLabel="name"
                            optionValue="id" placeholder="Select a Category">
                        </p-dropdown>
                        <small *ngIf="submitted && !editTrainingLessonForm.controls['trainingLessonCategoryId'].valid"
                            class="text-red-500">Category is required.</small>
                    </div>

                    <div class="field">
                        <label for="tages">Tages</label>
                        <p-multiSelect formControlName="tages" [options]="tages" optionLabel="tagName" optionValue="id"
                            placeholder="Select Tages">
                        </p-multiSelect>
                    </div>
                </form>
            </ng-template>
            <ng-template pTemplate="footer">
                <button pButton pRipple label="Cancel" icon="pi pi-times" class="p-button-text"
                    (click)="declineEditTrainingLesson()"></button>

                <button pButton pRipple label="Save" icon="pi pi-check" class="p-button-text"
                    (click)="saveEditTrainingLesson()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="deletionTrainingLessonDialog" header="Delete Training Lesson" [modal]="true"
            [style]="{ width: '450px' }">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span *ngIf="trainingLesson">Are you sure you want to delete <b>{{ trainingLesson.name }}</b> ?</span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
                    (click)="declineDeletion()"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes"
                    (click)="confirmDeletion()"></button>
            </ng-template>
        </p-dialog>

        <p-dialog [(visible)]="switchActivationTrainingLessonDialog" header="Activation Training Lesson" [modal]="true"
            [style]="{ width: '450px' }">
            <div class="flex align-items-center justify-content-center">
                <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                <span *ngIf="trainingLesson">
                    Are you sure you want to
                    <span style="color: red">{{ trainingLesson.isActive ? 'Deactivate ' : 'Activate ' }}</span>
                    <b>{{ trainingLesson.name }}</b>?
                </span>
            </div>
            <ng-template pTemplate="footer">
                <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
                    (click)="declineActivation()"></button>
                <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes"
                    (click)="confirmtActivation()"></button>
            </ng-template>
        </p-dialog>

    </div>
</div>

<p-dialog [(visible)]="libraryWallpaperDialog"
    header="{{ 'security-training.security-training-create.dialogs.libraryWallpaperDialog.header' | translate }}"
    [modal]="true" [style]="{ width: '80%', height: '80vh' }">
    <div class="mb-4">
        <p-button (click)="BacktoWallapapersGallery()" icon="pi pi-arrow-left" label="{{
                'security-training.security-training-create.dialogs.libraryWallpaperDialog.actions.back' | translate
            }}"></p-button>
    </div>
    <app-wallpaper-list-wizard></app-wallpaper-list-wizard>
</p-dialog>

<p-dialog [(visible)]="chooseWllpapersDialog"
    header="{{ 'security-training.security-training-create.dialogs.chooseWllpapersDialog.header' | translate }}"
    [modal]="true" [style]="{ width: '80%', height: '80vh' }">
    <div class="card">
        <p-toast></p-toast>
        <p-dataView #dv [value]="wallpapers" [paginator]="true" [rows]="12" layout="grid">
            <ng-template pTemplate="header">
                <div class="flex flex-column md:flex-row md:justify-content-between md:align-items-center">
                    <h5 class="m-0">
                        {{
                        'security-training.security-training-create.dialogs.chooseWllpapersDialog.fields.wallpaper'
                        | translate
                        }}
                    </h5>
                    <div class="my-1">
                        <button pButton pRipple label="{{
                                'security-training.security-training-create.dialogs.chooseWllpapersDialog.actions.add'
                                    | translate
                            }}" icon="pi pi-plus" class="p-button mr-2" (click)="CreateWallpaper()"></button>
                    </div>
                </div>
            </ng-template>

            <ng-template let-walls pTemplate="gridItem">
                <div class="grid grid-nogutter">
                    <div class="col-12 md:col-4" *ngFor="let wall of walls">
                        <div class="card m-3 border-1 surface-border">
                            <p-checkbox [id]="wall?.id" [ngModel]="checkboxStates[wall?.id]" [binary]="true"
                                (onChange)="toggleSelection($event, wall)">
                            </p-checkbox>

                            <div class="mb-3">
                                <div class="flex flex-wrap justify-content-center">
                                    <img (click)="toggleSelection(null, wall)" [src]="wall.wallpaperImageUrl"
                                        [alt]="wall.wallpaperTitle" class="w-9 shadow-2 my-3 mx-0"
                                        style="width: 100px; height: 140px; cursor: pointer" />
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold">{{ wall.wallpaperTitle }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-template>
        </p-dataView>
    </div>

    <ng-template pTemplate="footer">
        <button pButton pRipple icon="pi pi-check" class="p-button-text" label="{{
                'security-training.security-training-create.dialogs.chooseWllpapersDialog.actions.continue' | translate
            }}" (click)="confirmWallpaperSelected()"></button>
    </ng-template>
</p-dialog>